<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detection Results</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Detection Results</h1>
        <p class="subtitle">Your analysis has been completed successfully</p>
      </header>

      <div class="result-section">
        <section>
          <h2>Unique Objects per Room</h2>
          {% if results.unique_counts %}
          <ul class="object-list">
            {% for room_id, objects in results.unique_counts.items() %}
            <li class="object-list-item">
              <strong>{{ room_id }}</strong>
              <div style="margin-top: 0.75rem; color: var(--text-secondary)">
                {% for obj_name, count in objects.items() %}
                <span
                  style="
                    display: inline-block;
                    margin-right: 1.5rem;
                    margin-bottom: 0.5rem;
                  "
                >
                  <span style="color: var(--text-primary); font-weight: 500"
                    >{{ obj_name }}:</span
                  >
                  <span
                    style="
                      background: var(--bg-elevated);
                      padding: 0.25rem 0.75rem;
                      border-radius: var(--radius-sm);
                      font-weight: 600;
                    "
                    >{{ count }}</span
                  >
                </span>
                {% endfor %}
              </div>
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <div
            style="text-align: center; padding: 3rem; color: var(--text-muted)"
          >
            <p style="font-size: 1.125rem">
              No unique objects detected across any rooms.
            </p>
            <p style="margin-top: 0.5rem; font-size: 0.95rem">
              Try uploading images with more visible objects.
            </p>
          </div>
          {% endif %}
        </section>

        <section>
          <h2>Download Reports</h2>
          <div class="report-links">
            <a href="{{ results.json_report_url }}" class="btn" target="_blank">
              <span>JSON Report</span>
              <span style="opacity: 0.7">→</span>
            </a>
            <a
              href="{{ results.csv_report_url }}"
              class="btn btn-secondary"
              target="_blank"
            >
              <span>CSV Report</span>
              <span style="opacity: 0.7">→</span>
            </a>
          </div>
          <p
            style="
              color: var(--text-muted);
              font-size: 0.9rem;
              margin-top: 1rem;
            "
          >
            Download detailed reports in your preferred format for further
            analysis or integration.
          </p>
        </section>

        <section>
          <h2>Processed Images</h2>
          {% if results.processed_images %}
          <div class="image-grid">
            {% for image in results.processed_images %}
            <div class="image-grid-item">
              <div class="card-header">
                <div style="font-weight: 600; margin-bottom: 0.25rem">
                  {{ image.filename }}
                </div>
                <div
                  style="
                    font-size: 0.875rem;
                    color: var(--text-secondary);
                    font-weight: 400;
                  "
                >
                  Room: {{ image.room_id }}
                </div>
              </div>
              <div class="card-body">
                <img
                  src="{{ image.visualization_url }}"
                  class="image-preview"
                  alt="Detected Objects"
                />
                <div style="margin-top: 1rem">
                  <strong
                    style="
                      display: block;
                      margin-bottom: 0.75rem;
                      color: var(--text-primary);
                    "
                  >
                    Detections {% if image.detections %}
                    <span
                      style="
                        background: var(--bg-tertiary);
                        padding: 0.25rem 0.75rem;
                        border-radius: var(--radius-sm);
                        font-size: 0.875rem;
                        margin-left: 0.5rem;
                      "
                    >
                      {{ image.detections|length }}
                    </span>
                    {% endif %}
                  </strong>
                  {% if image.detections %}
                  <ul class="detection-list">
                    {% for det in image.detections %}
                    <li>
                      <span style="color: var(--text-primary); font-weight: 500"
                        >{{ det.class_name }}</span
                      >
                      <span
                        style="
                          color: var(--text-muted);
                          font-size: 0.875rem;
                          margin-left: 0.5rem;
                        "
                      >
                        Confidence: {{ det.confidence }}
                      </span>
                    </li>
                    {% endfor %}
                  </ul>
                  {% else %}
                  <p
                    style="
                      color: var(--text-muted);
                      font-size: 0.95rem;
                      padding: 1rem;
                      background: var(--bg-secondary);
                      border-radius: var(--radius-sm);
                      text-align: center;
                    "
                  >
                    No objects detected in this image
                  </p>
                  {% endif %}
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div
            style="text-align: center; padding: 3rem; color: var(--text-muted)"
          >
            <p style="font-size: 1.125rem">No images were processed.</p>
            <p style="margin-top: 0.5rem; font-size: 0.95rem">
              Please upload images to see results here.
            </p>
          </div>
          {% endif %}
        </section>
      </div>

      <div class="center-button">
        <a href="{{ url_for('index') }}" class="btn">
          <span>←</span>
          <span>Upload More Images</span>
        </a>
      </div>

      <footer>
        <p>&copy; 2025 Room-wise Unique Object Detection System</p>
        <p class="mt-1">Powered by YOLOv8 Deep Learning Technology</p>
      </footer>
    </div>

    <script>
      // Add smooth entrance animations
      document.addEventListener("DOMContentLoaded", function () {
        const items = document.querySelectorAll(
          ".object-list-item, .image-grid-item"
        );
        items.forEach((item, index) => {
          item.style.animationDelay = `${index * 0.1}s`;
        });
      });

      // Add intersection observer for scroll animations
      const observerOptions = {
        threshold: 0.1,
        rootMargin: "0px 0px -50px 0px",
      };

      const observer = new IntersectionObserver(function (entries) {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.style.opacity = "1";
            entry.target.style.transform = "translateY(0)";
          }
        });
      }, observerOptions);

      document.querySelectorAll("section").forEach((section) => {
        section.style.opacity = "0";
        section.style.transform = "translateY(20px)";
        section.style.transition = "opacity 0.6s ease, transform 0.6s ease";
        observer.observe(section);
      });
    </script>
  </body>
</html>
